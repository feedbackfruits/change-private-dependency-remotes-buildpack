#!/usr/bin/env bash

build_dir=$1
env_dir=$3

if [ "$DEPENDENCY_FILES" == "" ]; then
  depfiles="$env_dir/requirements.txt"
else
  depfiles="$env_dir/$DEPENDENCY_FILES"
fi

if [ "$ORIGINAL_REPO_URL" == "" ]; then
  echo "-----> No original url specified, choose default ssh:\/\/git@github.com:"
  original_url="ssh:\/\/git@github.com:"
else
  original_url=$ORIGINAL_REPO_URL
fi

if [ "$REPLACEMENT_REPO_URL" == "" ]; then
  if [ "$GITHUB_OAUTH_KEY" == "" ]; then
    echo "-----> No replacement url nor github oauth key specified"
    exit 1
  fi
  echo "-----> No replacement url specified, choose default https:\/\/$GITHUB_OAUTH_KEY:x-oauth-basic@github.com\/"
  replacement_url="https:\/\/$GITHUB_OAUTH_KEY:x-oauth-basic@github.com\/"
else
  replacement_url=$REPLACEMENT_REPO_URL
fi

# Looping over all depfiles
echo "-----> Renaming $original_url to $replacement_url in $depfiles"
cd $build_dir
sed -i.bak "s/$original_url/$replacement_url/g" $depfiles
exit 0

